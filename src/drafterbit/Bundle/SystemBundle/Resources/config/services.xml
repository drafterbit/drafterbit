<?xml version="1.0" ?>

<container xmlns="http://symfony.com/schema/dic/services"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

    <parameters>
        <!-- web -->
        <parameter key="web">%kernel.root_dir%/../web</parameter>
        <parameter key="vendor_dir">%kernel.root_dir%/../vendor</parameter>

        <!-- admin -->
        <parameter key="admin">admin</parameter>

        <!-- theme -->
        <parameter key="themes_path">%kernel.root_dir%/../themes</parameter>
    </parameters>

    <services>

        <!-- Security-->
        <service id="security.access.base_voter" class="drafterbit\Bundle\SystemBundle\Security\Authorization\Voter\BaseVoter">
            <argument type="service" id="security.attribute_provider" />
            <tag name="security.voter" />
        </service>

        <service id="security.attribute_provider" class="drafterbit\Bundle\SystemBundle\Security\Authorization\AttributeProvider">
            <argument type="service" id="kernel" />
        </service>

        <!-- System Model-->
        <service id="dt_system.model" class="drafterbit\Bundle\SystemBundle\Model\System">
            <argument type="service" id="service_container" />
        </service>

        <service id="system" alias="dt_system.model"/>

        <!-- Log Handler -->
        <service id="system_log_handler" class="drafterbit\Bundle\SystemBundle\Monolog\Handler\DoctrineDBALHandler">
            <argument type="service" id="service_container"/>
            <argument /> <!-- level -->
            <argument /> <!-- bubble -->
        </service>

        <!-- Log Displayer -->
        <service id="dt_system.log.display_formatter" class="drafterbit\System\Log\DisplayFormatter">
            <argument type="service" id="translator"/>
        </service>

        <service id="dt_system.frontpage.admin" class="drafterbit\Bundle\SystemBundle\System\Routing\Admin">
            <tag name="dt_system.frontpage"></tag>
            <argument type="service" id="service_container"/>
        </service>

        <service id="dt_system.frontpage.search" class="drafterbit\Bundle\SystemBundle\System\Routing\Search">
            <tag name="dt_system.frontpage"></tag>
            <argument type="service" id="service_container"/>
        </service>


        <!-- Frontpage Provider -->
        <service id="dt_system.application_route_manager" class="drafterbit\System\Routing\ApplicationRouteManager"/>

        <!-- Frontend Route loader -->
        <service id="dt_system.routing.loader" class="drafterbit\Bundle\SystemBundle\Routing\Loader\ViablePrefixLoader">
            <argument id="service_container" type="service"/>
            <tag name="routing.loader"></tag>
        </service>

        <!-- Event Listener -->
        <service id="dt_system.event.listener.frontent" class="drafterbit\Bundle\SystemBundle\EventListener\FrontendListener">
            <tag name="kernel.event_subscriber" />
            <argument type="service" id="service_container" />
        </service>

        <service id="dt_system.event.listener.cli_response" class="drafterbit\Bundle\SystemBundle\EventListener\CLIResponseListener">
            <tag name="kernel.event_subscriber" />
        </service>

        <!-- Search -->
        <service id="dt_system.search.engine" class="drafterbit\System\Search\Engine">
            <argument type="service" id="service_container" />
        </service>

        <service id="search_engine" alias="dt_system.search.engine"/>

        <!-- Form Type -->
        <service id="dt_system.form.type.entity_hidden" class="drafterbit\Bundle\SystemBundle\Form\Type\EntityHiddenType">
            <argument type="service" id="doctrine.orm.entity_manager" />
            <tag name="form.type" alias="entity_hidden"/>
        </service>

        <service id="dt_system.log.formatter.author" class="drafterbit\Bundle\SystemBundle\System\Log\AuthorEntityFormatter">
            <argument type="service" id="kernel" />
            <tag name="dt_system_log.display_formatter" />
        </service>

        <!-- setting -->
        <service id="dt_system.setting.field_manager" class="drafterbit\System\Setting\FieldManager"/>

        <service id="dt_system.setting.field.general" class="drafterbit\Bundle\SystemBundle\System\Setting\GeneralField">
            <argument type="service" id="service_container" />
            <tag name="dt_system.setting.field" />
        </service>

        <service id="dt_system.doctrine.subscribers.table_prefix" class="drafterbit\Bundle\SystemBundle\Doctrine\Subscriber\TablePrefixSubscriber">
            <argument>%database_table_prefix%</argument>
            <tag name="doctrine.event_subscriber" />
        </service>

        <!-- Extensions -->
        <service id="extension_manager" class="drafterbit\System\Extension\ExtensionManager">
            <argument type="service" id="service_container" />
        </service>

    </services>
</container>
